#!/usr/bin/python3

import subprocess
import time
import sys

from actuator import tester, monitor, action


if __name__ == "__main__":
        
    if len(sys.argv) <= 3:
        log.error("Expected: <monitor>[:key=value,... | value,...] <action>[:key=value,... | value,...] <test>[:key=value,... | value,...] ...")
        sys.exit(1)


    #parse action string
    act = action.parse(sys.argv[2])
    if not act:
        log.error("Action not recognised")
    
    #parse test string(s)
    tests = [tester.parse(a) for a in sys.argv[3:]]
    if not tests:
        log.error("Command not recognised")
        sys.exit(2)
    test = tester.AllTester(tests)

    #construct monitor
    mon = monitor.parse(test, act, sys.argv[1])
    mon.start()

