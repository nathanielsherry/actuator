#!/usr/bin/python3

import click

@click.command()
@click.option("-l", "--log-level", default='info', help='Select log level from [error, warn, info, debug, trace]')
@click.argument("expression")
def run(log_level, expression):

    from actuator import parser, source as mod_source, sink as mod_sink, package, util, log
    import sys

    log.set_level(log_level)

    #full expression
    node_manager = parser.parse_actuator_expression(expression)

    import yaml
    log.debug("Loaded nodes:\n---\n {}".format(node_manager.description))
    util.set_global('expression', expression)

    try:
        node_manager.start()
    except KeyboardInterrupt:
        pass
    except BrokenPipeError:
        pass

    util.run_shutdown_hooks()

    sys.stderr.close()
    
if __name__ == "__main__":
    run()
